[[ch03_bitcoin_client]]

== Bitcoin Core: L'implementazione di riferimento

Le persone accettano denaro in cambio dei loro beni e servizi solo se credono che potranno spendere quel denaro successivamente. Denaro contraffatto o svalutato in maniera inattesa potrebbe non essere accettato in futuro, perciò chiunque riceva bitcoin ha un forte incentivo a controllare attentamente che non vi siano problemi nel network. Il sistema Bitcoin è stato progettato in modo che sia possibile per il software in esecuzione sul tuo computer locale prevenire perfettamente la contraffazione, la svalutazione e altri problemi critici. Il software che fornisce questa funzione è chiamato _nodo di verifica completa_, perché verifica ogni transazione Bitcoin confermata rispetto a tutte le regole del sistema. I nodi di verifica completa, o semplicemente _nodi completi_ (full nodes), possono anche fornire strumenti e dati utili per comprendere il funzionamento di Bitcoin e cosa sta succedendo attualmente nella rete.

In questo capitolo installeremo Bitcoin Core, l'implementazione utilizzata dalla maggior parte degli operatori di full nodes fin dall'inizio della rete Bitcoin. Successivamente analizzeremo blocchi, transazioni e altri dati provenienti dal tuo nodo, dati che sono autorevoli non perché lo abbia deciso qualche entità potente, ma perché il tuo nodo li ha verificati autonomamente. Nel resto del libro continueremo a usare Bitcoin Core per creare ed esaminare dati relativi alla blockchain e alla rete.

=== Da Bitcoin a Bitcoin Core

Bitcoin è un progetto _open source_ e il codice sorgente è disponibile con una licenza aperta (MIT), scaricabile gratuitamente e utilizzabile per qualsiasi scopo. Oltre ad essere open source, Bitcoin è sviluppato da una comunità aperta di volontari. Inizialmente questa comunità era composta soltanto da Satoshi Nakamoto. Nel 2023 il codice sorgente di Bitcoin contava oltre 1.000 contributori, con circa una dozzina di sviluppatori impegnati a tempo pieno e diverse decine che collaborano part-time. Chiunque può contribuire al codice—compreso tu!

Quando Bitcoin fu creato da Satoshi Nakamoto, il software era già in gran parte completato prima della pubblicazione del whitepaper (puoi leggerlo in <<satoshi_whitepaper>>). Satoshi voleva assicurarsi che l'implementazione funzionasse correttamente prima di pubblicare il documento che lo descriveva. Quella prima implementazione, nota semplicemente come "Bitcoin", è stata pesantemente modificata e migliorata nel tempo. È evoluta in ciò che oggi è conosciuto come _Bitcoin Core_, per differenziarla da altre implementazioni. Bitcoin Core è l'_implementazione di riferimento_ del sistema Bitcoin, il che significa che fornisce un riferimento per come ogni parte della tecnologia dovrebbe essere implementata. Bitcoin Core implementa tutti gli aspetti di Bitcoin, compresi wallet, un motore di validazione di transazioni e blocchi, strumenti per la costruzione di blocchi, e tutte le parti moderne della comunicazione peer-to-peer di Bitcoin.

<<bitcoin_core_architecture>> mostra l'architettura di Bitcoin Core.

[[bitcoin_core_architecture]]
.Architettura di Bitcoin Core (Source: Eric Lombrozo).
image::images/mbc3_0301.png["Bitcoin Core Architecture"]

Anche se Bitcoin Core rappresenta l'implementazione di riferimento per molte parti fondamentali del sistema, il whitepaper di Bitcoin descrive diverse delle prime componenti del progetto. La maggior parte degli aggiornamenti più importanti dal 2011 in poi è documentata nei https://oreil.ly/BCXAQBitcoin[Improvement Proposals (BIP)]. Nel corso di questo libro, ci riferiremo a queste specifiche BIP utilizzando il loro numero; ad esempio, il BIP9 descrive un meccanismo utilizzato per diversi aggiornamenti importanti di Bitcoin.

=== Ambiente di sviluppo Bitcoin

Se sei uno sviluppatore, vorrai configurare un ambiente di sviluppo con tutti gli strumenti, le librerie e i software di supporto necessari per scrivere applicazioni Bitcoin. In questo capitolo molto tecnico, vedremo passo per passo come farlo. Se trovi che l'argomento diventa troppo complesso (e non stai effettivamente configurando un ambiente di sviluppo), puoi tranquillamente passare al capitolo successivo, meno tecnico.

[[compiling_core]]

=== Compilare Bitcoin Core dal codice sorgente

Il codice sorgente di Bitcoin Core può essere scaricato come file zip o clonando il repository GitHub. Vai alla pagina https://oreil.ly/hN9g1[pagina di download di Bitcoin Core], seleziona la versione più recente e scarica il file zip del codice sorgente. In alternativa, utilizza il comando Git per creare una copia locale del codice sorgente dalla pagina https://oreil.ly/BdOwl[GitHub di Bitcoin].


[SUGGERIMENTO]
====
In molti degli esempi di questo capitolo, useremo l'interfaccia a riga di comando del sistema operativo (nota anche come “shell”), accessibile tramite un'applicazione “terminal”. La shell mostrerà un prompt, tu digiterai un comando e la shell risponderà con del testo, quindi mostrerà di nuovo un prompt per il comando successivo. Il prompt potrebbe apparire diverso sul tuo sistema, ma negli esempi che seguono lo indicheremo con il simbolo +$+.

Quando, negli esempi, vedi del testo dopo il simbolo +$+, non digitare +$+ ma scrivi direttamente il comando che lo segue, poi premi Invio per eseguirlo. Nelle righe sotto ogni comando, invece, troverai le risposte del sistema operativo. Quando vedrai di nuovo il simbolo +$+, saprai che si tratta di un nuovo comando e potrai ripetere la procedura.
====

Qui, utilizziamo il comando +git+ per creare una copia locale (“clone”) del codice sorgente:

----
$ git clone https://github.com/bitcoin/bitcoin.git
Cloning into 'bitcoin'...
remote: Enumerating objects: 245912, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 245912 (delta 1), reused 2 (delta 1), pack-reused 245909
Receiving objects: 100% (245912/245912), 217.74 MiB | 13.05 MiB/s, done.
Resolving deltas: 100% (175649/175649), done.
----

[TIP]
====
Git is the most widely used
distributed version control system, an essential part of any software
developer's toolkit. You may need to install the +git+ command, or a
graphical user interface for Git, on your operating system if you do not
have it already.
====

Al termine dell’operazione di clonazione eseguita da Git, avrai una copia locale completa del repository di codice sorgente nella cartella _bitcoin_. Passa a questa cartella con il comando +cd+:

----
$ cd bitcoin
----

==== Selezionare una Versione di Bitcoin Core

Per impostazione predefinita, la copia locale sarà sincronizzata con il codice più recente, che potrebbe essere una versione instabile o beta di Bitcoin. Prima di compilare il codice, seleziona una versione specifica eseguendo un checkout su un _tag_ di release. Questo permetterà di sincronizzare la copia locale con una versione precisa del codice salvata nel repository, identificata da un'etichetta. Gli sviluppatori utilizzano i tag per contrassegnare le diverse versioni del codice in base al numero di versione. Per prima cosa, per trovare i tag disponibili, usiamo il comando +git tag+:

----
$ git tag
v0.1.5
v0.1.6test1
v0.10.0
...
v0.11.2
v0.11.2rc1
v0.12.0rc1
v0.12.0rc2
...
----

L'elenco dei tag mostra tutte le versioni rilasciate di Bitcoin. Per convenzione, le versioni _candidate al rilascio_, destinate ai test, hanno il suffisso "rc". Le versioni stabili, adatte all'uso in ambienti di produzione, non hanno alcun suffisso.
Dall'elenco precedente, seleziona la versione più recente, che al momento della scrittura era la v24.0.1. Per sincronizzare il codice locale con questa versione, utilizza il comando +git checkout+:

----
$ git checkout v24.0.1
Note: switching to 'v24.0.1'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

HEAD is now at b3f866a8d Merge bitcoin/bitcoin#26647: 24.0.1 final changes
----

Puoi confermare di aver selezionato la versione desiderata eseguendo il comando +git status+:

----
HEAD detached at v24.0.1
nothing to commit, working tree clean
----

==== Configurazione della Build di Bitcoin Core

Il codice sorgente include documentazione che può essere trovata in diversi file. Ti consigliamo di consultare la documentazione principale contenuta in _README.md_ nella directory _bitcoin_.

In questo capitolo, compileremo il daemon di Bitcoin Core (server), noto come +bitcoind+ su Linux (o altri sistemi Unix). Per istruzioni dettagliate sulla compilazione del client da riga di comando +bitcoind+ per la tua piattaforma, consulta il file _doc/build-unix.md_.

Nel caso di piattaforme diverse, puoi trovare istruzioni alternative nella directory _doc_; ad esempio, _build-windows.md_ contiene le istruzioni specifiche per Windows. Al momento della stesura di questa guida, sono disponibili istruzioni per Android, FreeBSD, NetBSD, OpenBSD, macOS (OSX), Unix e Windows.

Esamina attentamente i prerequisiti per la compilazione, che si trovano nella prima parte della documentazione sulla build. Questi prerequisiti includono librerie e pacchetti che devono essere presenti sul tuo sistema prima di iniziare a compilare Bitcoin Core.
Se uno di questi prerequisiti è mancante, il processo di compilazione fallirà con un errore. Se ciò accade perché hai dimenticato di installare un prerequisito, puoi semplicemente installarlo e poi riprendere la compilazione dal punto in cui l'avevi lasciata.
Una volta verificato che i prerequisiti siano tutti installati, puoi avviare il processo di compilazione generando una serie di script di build eseguendo lo script _autogen.sh_:

----
$ ./autogen.sh
libtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, 'build-aux'.
libtoolize: copying file 'build-aux/ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIRS, 'build-aux/m4'.
 ...
configure.ac:58: installing 'build-aux/missing'
src/Makefile.am: installing 'build-aux/depcomp'
parallel-tests: installing 'build-aux/test-driver'
----

Lo script _autogen.sh_ genera una serie di script di configurazione automatica che analizzeranno il tuo sistema per individuare le impostazioni corrette e verificare che siano presenti tutte le librerie necessarie per compilare il codice.
Il più importante di questi script è +configure+, che offre diverse opzioni per personalizzare il processo di compilazione. Per visualizzare le varie opzioni disponibili, utilizza il flag +--help+:

----
$ ./configure --help
`configure' configures Bitcoin Core 24.0.1 to adapt to many kinds of systems.

Usage: ./configure [OPTION]... [VAR=VALUE]...

...
Optional Features:
  --disable-option-checking  ignore unrecognized --enable/--with options
  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
  --enable-silent-rules   less verbose build output (undo: "make V=1")
  --disable-silent-rules  verbose build output (undo: "make V=0")
...
----

Lo script +configure+ ti permette di abilitare o disabilitare specifiche funzionalità di +bitcoind+ tramite i flag +--enable-FEATURE+ e +--disable-FEATURE+, in cui pass:[<span
class="keep-together"><code>FEATURE</code></span>] deve essere sostituito con il nome della funzionalità, come indicato nell'output della guida.
In questo capitolo compileremo il client +bitcoind+ con tutte le funzionalità predefinite, senza utilizzare flag di configurazione. Tuttavia, è consigliabile esaminarli per comprendere quali funzionalità opzionali fanno parte del client.
Se ti trovi in un ambiente accademico, ad esempio in un laboratorio informatico, potresti dover installare le applicazioni nella tua directory personale, utilizzando ad esempio l'opzione +--prefix=$HOME+.
Ecco alcune opzioni utili che consentono di modificare il comportamento predefinito dello script +configure+:

++++
<dl>
<dt><code>--prefix=$HOME</code></dt>
<dd><p>This overrides the default installation location (which is <em>/usr/local/</em>) for the resulting executable. Use <code>$HOME</code> to put everything in your home directory, or a different path.</p></dd>

<dt><code>--disable-wallet</code></dt>
<dd><p>This is used to disable the reference wallet implementation.</p></dd>

<dt><code>--with-incompatible-bdb</code></dt>
<dd><p>If you are building a wallet, allow the use of an incompatible version of the Berkeley DB library.</p></dd>

<dt><code>--with-gui=no</code></dt>
<dd><p>Don't build the graphical user interface, which requires the Qt library. This builds server and command-line Bitcoin Core only.</p></dd>
</dl>
++++

Successivamente, esegui lo script +configure+ per individuare automaticamente tutte le librerie necessarie e creare uno script di build personalizzato per il tuo sistema:

----
$ ./configure
checking for pkg-config... /usr/bin/pkg-config
checking pkg-config is at least version 0.9.0... yes
checking build system type... x86_64-pc-linux-gnu
checking host system type... x86_64-pc-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
...
[many pages of configuration tests follow]
...
----

Se tutto è andato bene, il comando +configure+ terminerà creando gli script di build personalizzati che ci permetteranno di compilare +bitcoind+. Se invece mancano librerie o si verificano errori, il comando +configure+ si interromperà con un errore anziché generare gli script di build.
Se si verifica un errore, è molto probabile che sia dovuto alla mancanza di una libreria necessaria o a una libreria incompatibile. In questo caso, rivedi la documentazione relativa alla compilazione e assicurati di installare tutti i prerequisiti mancanti. Dopodiché, esegui nuovamente +configure+ e verifica se il problema è stato risolto.

==== Compilazione degli eseguibili di Bitcoin Core

Successivamente, compilerai il codice sorgente, un processo che può richiedere fino a un'ora per completarsi, a seconda della velocità della CPU e della memoria disponibile.
Se si verifica un errore o se il processo di compilazione viene interrotto, è possibile riprenderlo in qualsiasi momento semplicemente digitando di nuovo +make+.
Digita *+make+* per avviare la compilazione dell'applicazione eseguibile:

----
$ make
Making all in src
  CXX      bitcoind-bitcoind.o
  CXX      libbitcoin_node_a-addrdb.o
  CXX      libbitcoin_node_a-addrman.o
  CXX      libbitcoin_node_a-banman.o
  CXX      libbitcoin_node_a-blockencodings.o
  CXX      libbitcoin_node_a-blockfilter.o
[... many more compilation messages follow ...]
----

Su un sistema veloce con più di una CPU, potresti voler impostare il numero di processi di compilazione paralleli. Ad esempio, il comando +make -j 2+ utilizzerà due core, se disponibili.
Se tutto è andato bene, Bitcoin Core è ora compilato. A questo punto, dovresti eseguire la suite di test unitari con il comando +make check+ per verificare che le librerie collegate non presentino errori evidenti.
L'ultimo passaggio consiste nell'installare i vari eseguibili sul tuo sistema utilizzando il comando +make install+. Potrebbe essere richiesto di inserire la password dell'utente, poiché questo passaggio richiede privilegi di amministratore.

----
$ make check && sudo make install
Password:
Making install in src
 ../build-aux/install-sh -c -d '/usr/local/lib'
libtool: install: /usr/bin/install -c bitcoind /usr/local/bin/bitcoind
libtool: install: /usr/bin/install -c bitcoin-cli /usr/local/bin/bitcoin-cli
libtool: install: /usr/bin/install -c bitcoin-tx /usr/local/bin/bitcoin-tx
...
----

L'installazione predefinita di +bitcoind+ lo posiziona in _/usr/local/bin_. Puoi confermare che Bitcoin Core è stato installato correttamente chiedendo al sistema il percorso degli eseguibili, come segue:

----
$ which bitcoind
/usr/local/bin/bitcoind

$ which bitcoin-cli
/usr/local/bin/bitcoin-cli
----

=== Esecuzione di un Nodo Bitcoin Core

La rete peer-to-peer di Bitcoin è composta da "nodi", gestiti principalmente da individui e da alcune aziende che forniscono servizi Bitcoin. Chi esegue un nodo Bitcoin ha una visione diretta e autorevole della blockchain di Bitcoin, con una copia locale di tutti i bitcoin spendibili, validata in modo indipendente dal proprio sistema.
Eseguendo un nodo, non devi fare affidamento su terze parti per validare una transazione. Inoltre, utilizzando un nodo Bitcoin per verificare completamente le transazioni che ricevi nel tuo wallet, contribuisci alla rete Bitcoin, rendendola più robusta e sicura.

Eseguire un nodo, tuttavia, richiede il download e l'elaborazione di oltre 500 GB di dati iniziali, oltre a circa 400 MB di transazioni Bitcoin al giorno. Questi dati si riferiscono al 2023 e probabilmente aumenteranno nel tempo.
Se spegni il tuo nodo o perdi la connessione a Internet per diversi giorni, il nodo dovrà scaricare i dati mancanti al momento della riattivazione. Ad esempio, se chiudi Bitcoin Core per 10 giorni, al successivo avvio dovrai scaricare circa 4 GB di dati.
A seconda che tu scelga di indicizzare tutte le transazioni e conservare una copia completa della blockchain, potresti aver bisogno di una notevole quantità di spazio su disco—almeno 1 TB se prevedi di eseguire Bitcoin Core per diversi anni.
Per impostazione predefinita, i nodi Bitcoin trasmettono anche transazioni e blocchi ad altri nodi (chiamati "peer"), consumando banda internet in upload. Se la tua connessione Internet è limitata, ha un tetto massimo di dati o è tariffata in base al consumo (ad esempio, paghi per ogni gigabit trasferito), probabilmente non dovresti eseguire un nodo Bitcoin su di essa, oppure dovresti configurarlo in modo da limitare il consumo di banda (vedi <<bitcoincorenode_config>>).
In alternativa, puoi collegare il tuo nodo a una rete diversa, come un fornitore di dati satellitari gratuito, ad esempio https://oreil.ly/cIwf3[Blockstream Satellite].

[TIP]
====

Bitcoin Core mantiene per impostazione predefinita una copia completa della blockchain, contenente quasi tutte le transazioni confermate sulla rete Bitcoin sin dal suo inizio nel 2009. Questo dataset occupa centinaia di gigabyte e viene scaricato gradualmente nel corso di diverse ore o giorni, a seconda della velocità della CPU e della connessione internet.
Bitcoin Core non sarà in grado di elaborare transazioni o aggiornare i saldi degli account fino a quando l'intero dataset della blockchain non sarà stato scaricato. Assicurati di avere spazio su disco sufficiente, una larghezza di banda adeguata e il tempo necessario per completare la sincronizzazione iniziale.
Puoi configurare Bitcoin Core per ridurre la dimensione della blockchain eliminando i blocchi più vecchi, ma dovrà comunque scaricare l’intero dataset.
====

Nonostante questi requisiti di risorse, migliaia di persone eseguono nodi Bitcoin. Alcuni funzionano su sistemi semplici come un Raspberry Pi, un computer da 35 dollari delle dimensioni di un mazzo di carte.

[role="less_space pagebreak-before"]
Perché dovresti voler eseguire un nodo? 
Ecco alcune delle ragioni più comuni:

- Non vuoi fare affidamento su terze parti per validare le transazioni che ricevi.

- Non vuoi rivelare a terzi quali transazioni appartengono al tuo wallet.

- Stai sviluppando software Bitcoin e hai bisogno di un nodo Bitcoin per accedere alla rete e alla blockchain tramite API.

- Stai creando applicazioni che devono validare le transazioni in base alle regole di consenso di Bitcoin. Di solito, le aziende che sviluppano software Bitcoin gestiscono diversi nodi.

- Vuoi supportare Bitcoin. Eseguire un nodo per validare le transazioni che ricevi nel tuo wallet contribuisce a rendere la rete più robusta e sicura.

Se stai leggendo questo libro e sei interessato a una sicurezza avanzata, a una maggiore privacy o allo sviluppo di software Bitcoin, dovresti eseguire il tuo nodo.


[[bitcoincorenode_config]]
=== Configurare il Nodo Bitcoin Core

Bitcoin Core cercherà un file di configurazione nella sua directory dei dati a ogni avvio. In questa sezione esamineremo le varie opzioni di configurazione e imposteremo un file di configurazione.
Per individuare il file di configurazione, esegui +bitcoind
-printtoconsole+ nel terminale e osserva le prime righe dell'output:

----
$ bitcoind -printtoconsole
2023-01-28T03:21:42Z Bitcoin Core version v24.0.1
2023-01-28T03:21:42Z Using the 'x86_shani(1way,2way)' SHA256 implementation
2023-01-28T03:21:42Z Using RdSeed as an additional entropy source
2023-01-28T03:21:42Z Using RdRand as an additional entropy source
2023-01-28T03:21:42Z Default data directory /home/harding/.bitcoin
2023-01-28T03:21:42Z Using data directory /home/harding/.bitcoin
2023-01-28T03:21:42Z Config file: /home/harding/.bitcoin/bitcoin.conf
...
[a lot more debug output]
...
----

Puoi premere Ctrl+C per spegnere il nodo una volta individuata la posizione del file di configurazione.
Di solito, il file di configurazione si trova nella directory dei dati _.bitcoin_ all'interno della home directory dell'utente.
Apri il file di configurazione con il tuo editor preferito per modificarlo.

Bitcoin Core offre più di 100 opzioni di configurazione che modificano il comportamento del nodo di rete, la gestione dello storage della blockchain e molti altri aspetti del suo funzionamento.
Per visualizzare l'elenco completo di queste opzioni, esegui il comando +bitcoind  --help+ nel terminale:

----
$ bitcoind --help
Bitcoin Core version v24.0.1

Usage:  bitcoind [options]                     Start Bitcoin Core

Options:

  -?
       Print this help message and exit

  -alertnotify=<cmd>
       Execute command when an alert is raised (%s in cmd is replaced by
       message)
...
[many more options]
----

Ecco alcune delle opzioni più importanti che puoi impostare nel file di configurazione o come parametri da riga di comando per +bitcoind+:

++alertnotify++:: Esegui un comando o uno script specifico per inviare avvisi di emergenza al proprietario di questo nodo.

++conf++:: Una posizione alternativa per il file di configurazione. Questa opzione ha senso solo come parametro da riga di comando per +bitcoind+, poiché non può essere specificata all'interno del file di configurazione a cui si riferisce.

++datadir++:: Seleziona la directory e il filesystem in cui salvare tutti i dati della blockchain. Per impostazione predefinita, viene utilizzata la sottodirectory _.bitcoin_ nella tua home directory. A seconda della configurazione, lo spazio utilizzato può variare da circa 10 GB fino a quasi 1 TB al momento della scrittura, con una crescita prevista di diverse centinaia di gigabyte all'anno.

++prune++:: Riduci i requisiti di spazio su disco della blockchain a un determinato numero di megabyte eliminando i blocchi più vecchi. Usa questa opzione su un nodo con risorse limitate che non può contenere l'intera blockchain. Tuttavia, altre parti del sistema utilizzeranno comunque spazio su disco aggiuntivo che al momento non può essere ridotto, quindi sarà comunque necessario disporre almeno dello spazio minimo indicato nell'opzione +datadir+.

++txindex++:: Mantieni un indice di tutte le transazioni. Questo consente di recuperare tramite script qualsiasi transazione tramite il suo ID, a condizione che il blocco contenente quella transazione non sia stato eliminato tramite pruning.

[role="less_space pagebreak-before"]
++dbcache++:: La dimensione della cache UTXO. Il valore predefinito è di 450 mebibyte (MiB). Aumenta questa dimensione su hardware di fascia alta per ridurre la frequenza di lettura e scrittura sul disco, oppure riducila su hardware di fascia bassa per risparmiare memoria, a scapito di un utilizzo più frequente del disco.

++blocksonly++:: Minimizza l'utilizzo della larghezza di banda accettando solo blocchi di transazioni confermate dai tuoi peer, invece di trasmettere transazioni non confermate.

++maxmempool++:: Limita la dimensione del memory pool delle transazioni a un determinato numero di megabyte. Utilizza questa opzione per ridurre il consumo di memoria su nodi con risorse limitate.

[[txindex]]
=== Indice del Database delle Transazioni e Opzione txindex

Per impostazione predefinita, Bitcoin Core crea un database contenente _solo_ le transazioni relative al wallet dell'utente. Se desideri poter accedere a qualsiasi transazione utilizzando comandi come +getrawtransaction+ (vedi <<exploring_and_decoding_transactions>>), devi configurare Bitcoin Core per creare un indice completo delle transazioni. Questo può essere ottenuto con l'opzione +txindex+.
Per attivarlo, imposta +txindex=1+ nel file di configurazione di Bitcoin Core. Se inizialmente non attivi questa opzione e successivamente scegli di abilitare l'indicizzazione completa, dovrai attendere il tempo necessario per la ricostruzione dell'indice.

<<full_index_node>> mostra come puoi combinare le opzioni precedenti con un nodo completamente indicizzato, eseguendolo come un API backend per un'applicazione Bitcoin.

[[full_index_node]]
.Esempio di configutazione di un nodo con indice completo
====
----
alertnotify=myemailscript.sh "Alert: %s"
datadir=/lotsofspace/bitcoin
txindex=1
----
====

<<constrained_resources>> mostra un nodo con risorse limitate in esecuzione su un server di dimensioni ridotte.

[[constrained_resources]]
.Sample configuration of a resource-constrained system
====
----
alertnotify=myemailscript.sh "Alert: %s"
blocksonly=1
prune=5000
dbcache=150
maxmempool=150
----
====

Dopo aver modificato il file di configurazione e impostato le opzioni che meglio soddisfano le tue esigenze, puoi testare +bitcoind+ con questa configurazione.
Esegui Bitcoin Core con l'opzione +printtoconsole+ per avviarlo in primo piano con l'output visualizzato direttamente sulla console:

----
$ bitcoind -printtoconsole
2023-01-28T03:43:39Z Bitcoin Core version v24.0.1
2023-01-28T03:43:39Z Using the 'x86_shani(1way,2way)' SHA256 implementation
2023-01-28T03:43:39Z Using RdSeed as an additional entropy source
2023-01-28T03:43:39Z Using RdRand as an additional entropy source
2023-01-28T03:43:39Z Default data directory /home/harding/.bitcoin
2023-01-28T03:43:39Z Using data directory /lotsofspace/bitcoin
2023-01-28T03:43:39Z Config file: /home/harding/.bitcoin/bitcoin.conf
2023-01-28T03:43:39Z Config file arg: [main] blockfilterindex="1"
2023-01-28T03:43:39Z Config file arg: [main] maxuploadtarget="1000"
2023-01-28T03:43:39Z Config file arg: [main] txindex="1"
2023-01-28T03:43:39Z Setting file arg: wallet = ["msig0"]
2023-01-28T03:43:39Z Command-line arg: printtoconsole=""
2023-01-28T03:43:39Z Using at most 125 automatic connections 
2023-01-28T03:43:39Z Using 16 MiB out of 16 MiB requested for signature cache
2023-01-28T03:43:39Z Using 16 MiB out of 16 MiB requested for script execution 
2023-01-28T03:43:39Z Script verification uses 3 additional threads
2023-01-28T03:43:39Z scheduler thread start
2023-01-28T03:43:39Z [http] creating work queue of depth 16
2023-01-28T03:43:39Z Using random cookie authentication.
2023-01-28T03:43:39Z Generated RPC cookie /lotsofspace/bitcoin/.cookie
2023-01-28T03:43:39Z [http] starting 4 worker threads
2023-01-28T03:43:39Z Using wallet directory /lotsofspace/bitcoin/wallets
2023-01-28T03:43:39Z init message: Verifying wallet(s)…
2023-01-28T03:43:39Z Using BerkeleyDB version Berkeley DB 4.8.30
2023-01-28T03:43:39Z Using /16 prefix for IP bucketing
2023-01-28T03:43:39Z init message: Loading P2P addresses…
2023-01-28T03:43:39Z Loaded 63866 addresses from peers.dat  114ms
[... more startup messages ...]
----

Puoi premere Ctrl-C per interrompere il processo una volta che sei sicuro che stia caricando le impostazioni corrette e funzionando come previsto.

Per eseguire Bitcoin Core in background come processo, avvialo con l'opzione +daemon+, utilizzando il comando +bitcoind -daemon+.

Per monitorare lo stato di avanzamento e il funzionamento del tuo nodo Bitcoin, avvialo in modalità daemon e poi utilizza il comando +bitcoin-cli getblockchaininfo+:

----
$ bitcoin-cli getblockchaininfo
----

[source,json]
----
{
  "chain": "main",
  "blocks": 0,
  "headers": 83999,
  "bestblockhash": "[...]19d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",
  "difficulty": 1,
  "time": 1673379796,
  "mediantime": 1231006505,
  "verificationprogress": 3.783041623201835e-09,
  "initialblockdownload": true,
  "chainwork": "[...]000000000000000000000000000000000000000000000100010001",
  "size_on_disk": 89087,
  "pruned": false,
  "warnings": ""
}
----

Questo mostra un nodo con un'altezza della blockchain pari a 0 blocchi e 83.999 header. Il nodo, per prima cosa, recupera gli header dei blocchi dai suoi peer per individuare la blockchain con la maggiore proof of work e, successivamente, procede a scaricare i blocchi completi, validandoli man mano.

Una volta che sei soddisfatto delle opzioni di configurazione selezionate, dovresti aggiungere Bitcoin Core agli script di avvio del tuo sistema operativo, in modo che venga eseguito continuamente e si riavvii automaticamente quando il sistema operativo si riavvia.

Nel codice sorgente di Bitcoin Core, sotto la directory _contrib/init_, troverai diversi esempi di script di avvio per vari sistemi operativi, insieme a un file README.md che indica quale sistema utilizza quale script.

=== API Bitcoin Core 
Bitcoin Core implementa un'interfaccia JSON-RPC che può essere raggiunta anche utilizzando l'helper da riga di comando +bitcoin-cli+. Da riga di comando possiamo sperimentare in modo interattivo le stesse funzionalità disponibili in modo programmabile tramite l'API.

Per iniziare, esegui il comando +help+ per visualizzare l’elenco dei comandi RPC disponibili in Bitcoin Core.

[[bitcoind_commands]]

----
$ bitcoin-cli help
+== Blockchain ==
getbestblockhash
getblock "blockhash" ( verbosity )
getblockchaininfo
...
walletpassphrase "passphrase" timeout
walletpassphrasechange "oldpassphrase" "newpassphrase"
walletprocesspsbt "psbt" ( sign "sighashtype" bip32derivs finalize )
----


Ognuno di questi comandi può accettare diversi parametri. Per ottenere ulteriore aiuto, una descrizione dettagliata e informazioni sui parametri, aggiungi il nome del comando dopo +help+. Ad esempio, per visualizzare l'aiuto relativo al comando RPC +getblockhash+:

----
$ bitcoin-cli help getblockhash
getblockhash height

Returns hash of block in best-block-chain at height provided.

Arguments:
1. height    (numeric, required) The height index

Result:
"hex"    (string) The block hash

Examples:
> bitcoin-cli getblockhash 1000
> curl --user myusername --data-binary '{"jsonrpc": "1.0", "id": "curltest",
  "method": "getblockhash", 
  "params": [1000]}' -H 'content-type: text/plain;' http://127.0.0.1:8332/
----

Alla fine delle informazioni di aiuto vedrai due esempi di comandi RPC, che utilizzano l’helper +bitcoin-cli+ o il client HTTP +curl+. Questi esempi mostrano come potresti chiamare il comando. Copia il primo esempio e guarda il risultato che ottieni:

----
$ bitcoin-cli getblockhash 1000
00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09
----

Il risultato è un hash di blocco, descritto più nel dettaglio nei capitoli successivi. Per il momento, però, questo comando dovrebbe restituire lo stesso risultato anche sul tuo sistema, dimostrando che il tuo nodo Bitcoin Core è attivo, sta accettando comandi e possiede le informazioni da restituirti sul blocco 1.000.

Nelle prossime sezioni mostreremo alcuni comandi RPC molto utili e il loro output previsto.

==== Ottenere informazioni sullo stato di Bitcoin Core.

Bitcoin Core fornisce rapporti di stato sui diversi moduli tramite l'interfaccia JSON-RPC. I comandi più importanti sono +getblockchaininfo+, +getmempoolinfo+, +getnetworkinfo+, and +getwalletinfo+.

Il comando RPC +getblockchaininfo+ di Bitcoin è stato introdotto in precedenza. Il comando +getnetworkinfo+ mostra informazioni di base sullo stato del nodo della rete Bitcoin. Utilizza +bitcoin-cli+ per eseguirlo:

----
$ bitcoin-cli getnetworkinfo
----
[source,json]
----
{
  "version": 240001,
  "subversion": "/Satoshi:24.0.1/",
  "protocolversion": 70016,
  "localservices": "0000000000000409",
  "localservicesnames": [
    "NETWORK",
    "WITNESS",
    "NETWORK_LIMITED"
  ],
  "localrelay": true,
  "timeoffset": -1,
  "networkactive": true,
  "connections": 10,
  "connections_in": 0,
  "connections_out": 10,
  "networks": [
    "...detailed information about all networks..."
  ],
  "relayfee": 0.00001000,
  "incrementalfee": 0.00001000,
  "localaddresses": [
  ],
  "warnings": ""
}
----

I dati vengono restituiti in formato JavaScript Object Notation (JSON), facilmente "consumabile" da qualsiasi linguaggio di programmazione e anche piuttosto intuitivo per noi esseri umani. Tra queste informazioni troviamo i numeri di versione del software Bitcoin Core e del protocollo Bitcoin, il numero corrente di connessioni e varie altre informazioni sulla rete Bitcoin e sulle impostazioni di questo nodo.

[TIP]
====
Ci vorrà un po’ di tempo, forse più di un giorno, prima che +bitcoind+ raggiunga l’altezza della blockchain attuale mentre scarica i blocchi dagli altri nodi Bitcoin e convalida ogni transazione contenuta in essi—quasi un miliardo di transazioni al momento in cui scriviamo.

Puoi controllare i suoi progressi usando +getblockchaininfo+ per vedere il numero di blocchi noti. Gli esempi nel resto di questo capitolo presuppongono che tu abbia raggiunto almeno il blocco 775,072. Poiché la sicurezza delle transazioni Bitcoin dipende dai blocchi, alcune delle informazioni nei prossimi esempi cambieranno leggermente in base al numero di blocchi del tuo nodo.
====

[[exploring_and_decoding_transactions]]
==== Esplorare e Decodificare le Transazioni
In <<spending_bitcoin>>, Alice ha effettuato un acquisto presso il negozio di Bob. La sua transazione è stata registrata sulla blockchain.
Utilizziamo l’API per recuperare ed esaminare quella transazione mettendo l’ID della transazione (txid) come parametro:

[[alice_tx_serialized]]
.Alice's serialized transaction
----
$ bitcoin-cli getrawtransaction 466200308696215bbc949d5141a49a41\
38ecdfdfaa2a8029c1f9bcecd1f96177

01000000000101eb3ae38f27191aa5f3850dc9cad00492b88b72404f9da13569
8679268041c54a0100000000ffffffff02204e0000000000002251203b41daba
4c9ace578369740f15e5ec880c28279ee7f51b07dca69c7061e07068f8240100
000000001600147752c165ea7be772b2c0acb7f4d6047ae6f4768e0141cf5efe
2d8ef13ed0af21d4f4cb82422d6252d70324f6f4576b727b7d918e521c00b51b
e739df2f899c49dc267c0ad280aca6dab0d2fa2b42a45182fc83e81713010000
0000
----

[TIP]
====
Gli ID di transazione (txid) non sono autorevoli. L’assenza di un txid nella blockchain non significa che la transazione non sia stata elaborata. Questo fenomeno è noto come "malleabilità delle transazioni" perché le transazioni possono essere modificate prima di essere confermate in un blocco, cambiando di conseguenza il loro txid.

Una volta che una transazione è inclusa in un blocco, il suo txid non può cambiare se non avviene una riorganizzazione della blockchain, in cui quel blocco viene rimosso dalla best blockchain. Difficilmente si verificano delle riorganizzazioni dopo che una transazione ha ricevuto diverse conferme.
====

Il comando +getrawtransaction+ restituisce una transazione serializzata in notazione esadecimale. Per decodificarla, utilizziamo il comando +decoderawtransaction+, passando i dati esadecimali come parametro. Puoi copiare l’esadecimale restituito da +getrawtransaction+ e incollarlo come parametro per +decoderawtransaction+:

++++
<pre data-type="programlisting">
$ bitcoin-cli decoderawtransaction 01000000000101eb3ae38f27191aa5f3850dc9cad0\
0492b88b72404f9da135698679268041c54a0100000000ffffffff02204e00000000000022512\
03b41daba4c9ace578369740f15e5ec880c28279ee7f51b07dca69c7061e07068f82401000000\
00001600147752c165ea7be772b2c0acb7f4d6047ae6f4768e0141cf5efe2d8ef13ed0af21d4f\
4cb82422d6252d70324f6f4576b727b7d918e521c00b51be739df2f899c49dc267c0ad280aca6\
dab0d2fa2b42a45182fc83e817130100000000
</pre>
++++

++++
<pre data-type="programlisting" data-code-language="json">
{
  "txid": "466200308696215bbc949d5141a49a4138ecdfdfaa2a8029c1f9bcecd1f96177",
  "hash": "f7cdbc7cf8b910d35cc69962e791138624e4eae7901010a6da4c02e7d238cdac",
  "version": 1,
  "size": 194,
  "vsize": 143,
  "weight": 569,
  "locktime": 0,
  "vin": [
    {
      "txid": "4ac541802679866935a19d4f40728bb89204d0cac90d85f3a51a19...aeb",
      "vout": 1,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "cf5efe2d8ef13ed0af21d4f4cb82422d6252d70324f6f4576b727b7d918e5...301"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00020000,
      "n": 0,
      "scriptPubKey": {
        "asm": "1 3b41daba4c9ace578369740f15e5ec880c28279ee7f51b07dca...068",
        "desc": "rawtr(3b41daba4c9ace578369740f15e5ec880c28279ee7f51b...6ev",
        "hex": "51203b41daba4c9ace578369740f15e5ec880c28279ee7f51b07d...068",
        "address": "bc1p8dqa4wjvnt890qmfws83te0v3qxzsfu7ul63kp7u56w8q...5qn",
        "type": "witness_v1_taproot"
      }
    },
    {
      "value": 0.00075000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 7752c165ea7be772b2c0acb7f4d6047ae6f4768e",
        "desc": "addr(bc1qwafvze0200nh9vkq4jmlf4sy0tn0ga5w0zpkpg)#qq404gts",
        "hex": "00147752c165ea7be772b2c0acb7f4d6047ae6f4768e",
        "address": "bc1qwafvze0200nh9vkq4jmlf4sy0tn0ga5w0zpkpg",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}
</pre>
++++

La decodifica della transazione mostra tutti i componenti di questa transazione, compresi gli input e gli output. In questo caso, vediamo che la transazione ha utilizzato un input e generato due output. L’input di questa transazione era l’output di una transazione precedentemente confermata (mostrato come il +txid+ dell’input). I due output corrispondono al pagamento a Bob e al resto destinato ad Alice.

Possiamo esplorare ulteriormente la blockchain esaminando la transazione precedente, a cui questa transazione fa riferimento tramite il suo +txid+, utilizzando gli stessi comandi (ad esempio, [.keep-together]#+getrawtransaction+).# Passando da una transazione all’altra, possiamo seguire la catena delle transazioni a ritroso, man mano che le monete vengono trasmesse da un proprietario al successivo.

==== Esplorare i Blocchi
Esplorare i blocchi è simile all’esplorazione delle transazioni. Tuttavia, è possibile fare riferimento ai blocchi sia tramite la loro _altezza_ (height) sia tramite il loro _hash_. Per prima cosa, troviamo un blocco in base alla sua altezza.

Utilizziamo il comando +getblockhash+, che accetta come parametro l’altezza del blocco e restituisce l’_hash dell’header_  di quel blocco.

++++
<pre data-type="programlisting">
$ bitcoin-cli getblockhash 123456
0000000000002917ed80650c6174aac8dfc46f5fe36480aaef682ff6cd83c3ca
</pre>
++++

Ora che conosciamo l’hash dell’header del blocco scelto, possiamo interrogare quel blocco. Utilizziamo il comando +getblock+ inserendo l’hash del blocco come parametro:

++++
<pre data-type="programlisting">
$ bitcoin-cli getblock 0000000000002917ed80650c6174aac8dfc46f5fe36480aaef682f\
f6cd83c3ca
</pre>
++++

++++
<pre data-type="programlisting" data-code-language="json">
{
  "hash": "0000000000002917ed80650c6174aac8dfc46f5fe36480aaef682ff6cd83c3ca",
  "confirmations": 651742,
  "height": 123456,
  "version": 1,
  "versionHex": "00000001",
  "merkleroot": "0e60651a9934e8f0decd1c[...]48fca0cd1c84a21ddfde95033762d86c",
  "time": 1305200806,
  "mediantime": 1305197900,
  "nonce": 2436437219,
  "bits": "1a6a93b3",
  "difficulty": 157416.4018436489,
  "chainwork": "[...]00000000000000000000000000000000000000541788211ac227bc",
  "nTx": 13,
  "previousblockhash": "[...]60bc96a44724fd72daf9b92cf8ad00510b5224c6253ac40095",
  "nextblockhash": "[...]00129f5f02be247070bf7334d3753e4ddee502780c2acaecec6d66",
  "strippedsize": 4179,
  "size": 4179,
  "weight": 16716,
  "tx": [
    "5b75086dafeede555fc8f9a810d8b10df57c46f9f176ccc3dd8d2fa20edd685b",
    "e3d0425ab346dd5b76f44c222a4bb5d16640a4247050ef82462ab17e229c83b4",
    "137d247eca8b99dee58e1e9232014183a5c5a9e338001a0109df32794cdcc92e",
    "5fd167f7b8c417e59106ef5acfe181b09d71b8353a61a55a2f01aa266af5412d",
    "60925f1948b71f429d514ead7ae7391e0edf965bf5a60331398dae24c6964774",
    "d4d5fc1529487527e9873256934dfb1e4cdcb39f4c0509577ca19bfad6c5d28f",
    "7b29d65e5018c56a33652085dbb13f2df39a1a9942bfe1f7e78e97919a6bdea2",
    "0b89e120efd0a4674c127a76ff5f7590ca304e6a064fbc51adffbd7ce3a3deef",
    "603f2044da9656084174cfb5812feaf510f862d3addcf70cacce3dc55dab446e",
    "9a4ed892b43a4df916a7a1213b78e83cd83f5695f635d535c94b2b65ffb144d3",
    "dda726e3dad9504dce5098dfab5064ecd4a7650bfe854bb2606da3152b60e427",
    "e46ea8b4d68719b65ead930f07f1f3804cb3701014f8e6d76c4bdbc390893b94",
    "864a102aeedf53dd9b2baab4eeb898c5083fde6141113e0606b664c41fe15e1f"
  ]
}
</pre>
++++

La voce +confirmations+ ci indica la _profondità_ (depth) di questo blocco--quanti blocchi sono stati costruiti sopra di esso, indicando la difficoltà di modificare qualsiasi transazione in questo blocco. La +height+ (altezza) ci dice quanti blocchi hanno preceduto questo blocco. Vediamo la versione del blocco, l'ora in cui è stato creato (secondo il suo miner), il tempo mediano degli 11 blocchi che precedono questo blocco (una misurazione temporale più difficile da manipolare per i miner), e la dimensione del blocco in tre diverse misurazioni: la stripped size (dimensione senza dati legacy), la full size (dimensione completa) e la weight units (dimensione in unità di peso). Vediamo anche alcuni campi utilizzati per la sicurezza e la proof of work (merkle root, nonce, bits, difficulty e chainwork); esamineremo questi in dettaglio in <<mining>>.

==== Utilizzo dell'interfaccia programmabile di Bitcoin Core
L'helper +bitcoin-cli+ è molto utile per esplorare l'API di Bitcoin Core e testare le sue funzioni. Tuttavia, lo scopo principale di un'API è permettere l'accesso alle funzionalità in modo programmabile.
In questa sezione, mostreremo come accedere a Bitcoin Core da un altro programma.

L'API di Bitcoin Core è un'interfaccia JSON-RPC. JSON è un formato molto pratico per rappresentare i dati, leggibile sia dagli esseri umani che dai programmi.
RPC sta per remote [.keep-together]#procedure# call (chiamata di procedura remota), il che significa che stiamo invocando procedure (funzioni) che si trovano in remoto (sul nodo Bitcoin Core) tramite un protocollo di rete. In questo caso, il protocollo di rete utilizzato è _HTTP.5_ .

Quando abbiamo usato il comando +bitcoin-cli+ per ottenere aiuto su un comando, ci ha mostrato un esempio di utilizzo di +curl+, il versatile client HTTP da riga di comando, per costruire una di queste chiamate JSON-RPC:

----
$ curl --user myusername --data-binary '{"jsonrpc": "1.0", "id":"curltest",
  "method": "getblockchaininfo", 
  "params": [] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/
----

Questo comando mostra che +curl+ invia una richiesta HTTP all’host locale (127.0.0.1), connettendosi alla porta predefinita di Bitcoin RPC (8332) e inviando una richiesta +json-rpc+ per il metodo +getblockchaininfo+, utilizzando la codifica +text/plain+.

Potresti notare che +curl+ richiederà l'invio delle credenziali insieme alla richiesta. Bitcoin Core genera una password casuale ad ogni avvio e la salva nella directory dei dati con il nome +.cookie+.

L’helper +bitcoin-cli+ può leggere questo file di password se fornito con la directory dei dati. Allo stesso modo, puoi copiare la password e passarla a +curl+ (o a qualsiasi altro wrapper di livello superiore per le RPC di Bitcoin Core), come mostrato in <<cookie_auth>>.

[[cookie_auth]]
.Using cookie-based authentication with Bitcoin Core
====
----
$ cat .bitcoin/.cookie
  __cookie__:17c9b71cef21b893e1a019f4bc071950c7942f49796ed061b274031b17b19cd0

$ curl 
  --user __cookie__:17c9b71cef21b893e1a019f4bc071950c7942f49796ed061b274031b17b19cd0 
  --data-binary '{"jsonrpc": "1.0", "id":"curltest", 
  "method": "getblockchaininfo", 
  "params": [] }' -H 'content-type: text/plain;' http://127.0.0.1:8332/

{"result":{"chain":"main","blocks":799278,"headers":799278,
"bestblockhash":"000000000000000000018387c50988ec705a95d6f765b206b6629971e6978879",
"difficulty":53911173001054.59,"time":1689703111,"mediantime":1689701260,
"verificationprogress":0.9999979206082515,"initialblockdownload":false,
"chainwork":"00000000000000000000000000000000000000004f3e111bf32bcb47f9dfad5b",
"size_on_disk":563894577967,"pruned":false,"warnings":""},"error":null,
"id":"curltest"}
----
====

In alternativa, puoi creare una password statica utilizzando lo script helper fornito in [.keep-together]#_./share/rpcauth/rpcauth.py_# nella directory del codice sorgente di Bitcoin Core.

Se stai implementando una chiamata JSON-RPC nel tuo programma, puoi utilizzare una libreria HTTP generica per costruire la chiamata, in modo simile a quanto mostrato nell'esempio precedente con +curl+.

Tuttavia, esistono librerie nella maggior parte dei linguaggi di programmazione più diffusi che "wrappano" l'API di Bitcoin Core rendendo questo processo molto più semplice.
Utilizzeremo la libreria +python-bitcoinlib+ per semplificare l'accesso all’API. Questa libreria non fa parte del progetto Bitcoin Core e deve essere installata nel modo consueto in cui installi le librerie Python.
Ricorda che è necessario avere un’istanza attiva di Bitcoin Core, che verrà utilizzata per effettuare chiamate JSON-RPC.

Lo script Python in <<rpc_example>> esegue una semplice chiamata a +getblockchaininfo+ e stampa il parametro block dai dati restituiti da Bitcoin Core.

[[rpc_example]]
.Running +getblockchaininfo+ via Bitcoin Core's JSON-RPC API
====
[source,python]
----
include::code/rpc_example.py[]
----
====

Eseguendolo, otteniamo il seguente risultato:

----
$ python rpc_example.py
773973
----

Ci mostra quanti blocchi sono presenti nella blockchain del nostro nodo locale di Bitcoin Core. Anche se non è un risultato particolarmente impressionante, dimostra l'utilizzo basilare della libreria come interfaccia semplificata per l’API JSON-RPC di Bitcoin Core.

Proseguiamo utilizzando le chiamate +getrawtransaction+ e +decodetransaction+ per recuperare i dettagli del pagamento di Alice a Bob. In <<rpc_transaction>>, recuperiamo la transazione di Alice ed elenchiamo gli output della transazione.
Per ogni output, mostriamo l’indirizzo del destinatario e il valore. Ricordiamo che la transazione di Alice aveva un output per il pagamento a Bob e un output per il resto destinato ad Alice.

[[rpc_transaction]]
.Retrieving a transaction and iterating its outputs
====
[source,python]
----
include::code/rpc_transaction.py[]
----
====

Eseguendo questo codice, otteniamo:

----
$ python rpc_transaction.py
bc1p8dqa4wjvnt890qmfws83te0v3qxzsfu7ul63kp7u56w8qc0qwp5qv995qn 0.00020000
bc1qwafvze0200nh9vkq4jmlf4sy0tn0ga5w0zpkpg 0.00075000
----

Entrambi gli esempi precedenti sono piuttosto semplici. Non hai davvero bisogno di un programma per eseguirli; potresti facilmente utilizzare l’helper +bitcoin-cli+. Tuttavia, il prossimo esempio richiede diverse centinaia di chiamate RPC e dimostra più chiaramente l'utilizzo di un'interfaccia programmabile.

In <<rpc_block>>, iniziamo recuperando un blocco e poi estraiamo tutte le transazioni contenute al suo interno utilizzando i rispettivi transaction ID. Poi, analizziamo gli output di ogni transazione e sommiamo i relativi valori.

[[rpc_block]]
.Retrieving a block and adding all the transaction outputs
====
[source,python]
----
include::code/rpc_block.py[]
----
====

Eseguendo questo codice, otteniamo:

----
$ python rpc_block.py

Total value in block:  10322.07722534
----

Il nostro codice di esempio calcola che il valore totale transato in questo blocco è di 10.322,07722534 BTC (inclusi 25 BTC di ricompensa e 0,0909 BTC di commissioni). Confrontalo con l'importo riportato da un block explorer cercando l'hash o l'altezza del blocco. Alcuni block explorer mostrano il valore totale escludendo sia la ricompensa sia le commissioni. Vedi se riesci a notare la differenza.

[[alt_libraries]]
=== Client, librerie e toolkit alternativi

Nell’ecosistema Bitcoin esistono numerosi client alternativi, librerie, toolkit e persino implementazioni complete di full node. Sono realizzati in vari linguaggi di programmazione, offrendo agli sviluppatori un’interfaccia nativa nel linguaggio che preferiscono.

Le sezioni seguenti elencano alcune tra le migliori librerie, client e toolkit, suddivisi per linguaggio di programmazione.

==== C/C++
https://oreil.ly/BdOwl[Bitcoin Core] :: La versione di riferimento di Bitcoin

==== JavaScript
https://bcoin.io[bcoin]:: Un full node progettato per essere modulare e scalabile, con supporto API
https://bitcore.io[Bitcore] :: Un full node con API e libreria, realizzato da Bitpay
https://oreil.ly/4iqf2[BitcoinJS] :: Una libreria Bitcoin scritta interamente in JavaScript, per node.js e browser

==== Java
https://bitcoinj.github.io[bitcoinj]:: Una libreria Java per client full node

==== Python
https://oreil.ly/xn_rg[python-bitcoinlib]::  Una libreria Bitcoin in Python, una libreria per il consenso e un full node sviluppati da Peter Todd
https://oreil.ly/wcpXP[pycoin]:: Una libreria Bitcoin in Python sviluppati da Richard Kiss

==== Go
https://oreil.ly/h5MEI[btcd]:: Un client Bitcoin full node scritto in linguaggio Go

==== Rust
https://oreil.ly/me6gf[rust-bitcoin]:: Una libreria Bitcoin scritta in Rust, pensata per la serializzazione, l'analisi dei dati e le chiamate API

==== Scala
https://bitcoin-s.org[bitcoin-s]:: Una versione di Bitcoin sviluppata in Scala

==== C#
https://oreil.ly/Qfjgq[NBitcoin]:: Una libreria Bitcoin completa pensata per il framework .NET

Molte altre librerie sono disponibili per un'ampia varietà di linguaggi di programmazione e ne vengono create continuamente di nuove.

Se hai seguito le istruzioni di questo capitolo, ora hai Bitcoin Core in esecuzione e hai iniziato a esplorare la rete e la blockchain con il tuo full node. Da questo momento in poi, puoi utilizzare in modo indipendente un software sotto il tuo controllo (su un computer che controlli tu) per verificare che i bitcoin che ricevi rispettino tutte le regole del sistema Bitcoin, senza dover fare affidamento su alcuna autorità esterna. Nei prossimi capitoli, approfondiremo le regole del sistema e scopriremo come il tuo nodo e il tuo wallet le utilizzino per mettere al sicuro i tuoi fondi, proteggere la tua privacy e rendere l’invio e la ricezione delle transazioni più [.keep-together]#convenient.#.
